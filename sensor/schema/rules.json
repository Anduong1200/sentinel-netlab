{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "Sentinel NetLab Detection Rules",
    "description": "JSON schema for detection rule configuration",
    "type": "object",
    "required": [
        "rules"
    ],
    "properties": {
        "version": {
            "type": "string",
            "description": "Schema version"
        },
        "rules": {
            "type": "array",
            "items": {
                "$ref": "#/definitions/rule"
            }
        }
    },
    "definitions": {
        "rule": {
            "type": "object",
            "required": [
                "rule_id",
                "name",
                "severity",
                "conditions"
            ],
            "properties": {
                "rule_id": {
                    "type": "string",
                    "pattern": "^[A-Z]+-[0-9]{3}$",
                    "description": "Unique rule identifier (e.g., WIDS-001)"
                },
                "name": {
                    "type": "string",
                    "minLength": 1,
                    "description": "Human-readable rule name"
                },
                "description": {
                    "type": "string",
                    "description": "Detailed description of what the rule detects"
                },
                "severity": {
                    "type": "string",
                    "enum": [
                        "critical",
                        "high",
                        "medium",
                        "low",
                        "info"
                    ],
                    "description": "Alert severity level"
                },
                "enabled": {
                    "type": "boolean",
                    "default": true,
                    "description": "Whether the rule is active"
                },
                "conditions": {
                    "type": "array",
                    "minItems": 1,
                    "items": {
                        "$ref": "#/definitions/condition"
                    },
                    "description": "Conditions that must all match (AND logic)"
                },
                "threshold": {
                    "type": "object",
                    "properties": {
                        "count": {
                            "type": "integer",
                            "minimum": 1
                        },
                        "window_seconds": {
                            "type": "integer",
                            "minimum": 1
                        }
                    },
                    "description": "Threshold for rate-based detection"
                },
                "window_seconds": {
                    "type": "integer",
                    "minimum": 0,
                    "default": 0,
                    "description": "Time window for aggregation-based rules"
                },
                "mitre_technique_id": {
                    "type": "string",
                    "pattern": "^T[0-9]{4}(\\.[0-9]{3})?$",
                    "description": "MITRE ATT&CK technique ID (e.g., T1557)"
                },
                "mitre_technique_name": {
                    "type": "string",
                    "description": "MITRE ATT&CK technique name"
                },
                "mitre_tactic": {
                    "type": "string",
                    "description": "MITRE ATT&CK tactic"
                },
                "cooldown_seconds": {
                    "type": "integer",
                    "minimum": 0,
                    "default": 300,
                    "description": "Minimum seconds between alerts for this rule"
                },
                "tags": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    },
                    "description": "Tags for categorization"
                }
            }
        },
        "condition": {
            "type": "object",
            "required": [
                "field",
                "op",
                "value"
            ],
            "properties": {
                "field": {
                    "type": "string",
                    "description": "Field path (supports dot notation for nested fields)"
                },
                "op": {
                    "type": "string",
                    "enum": [
                        "eq",
                        "==",
                        "ne",
                        "!=",
                        "gt",
                        ">",
                        "gte",
                        ">=",
                        "lt",
                        "<",
                        "lte",
                        "<=",
                        "in",
                        "not_in",
                        "contains",
                        "regex",
                        "exists"
                    ],
                    "description": "Comparison operator"
                },
                "value": {
                    "description": "Value to compare against"
                }
            }
        }
    }
}